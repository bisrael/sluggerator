#!/usr/bin/env bash

set -e

# The actual compilation code lives in `bin/support/ruby_compile`. This file instead
# bootstraps the ruby needed and then executes `bin/support/ruby_compile`

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

BIN_DIR=$(cd $(dirname $0); pwd)
BUILDPACK_DIR=$(dirname $BIN_DIR)

file="$BUILD_DIR/Sluggerator"

while read -r line; do
  echo "Trying to sluggerate $line"

  while read -r line_item; do
    if [[ -f "$line" ]]; then
      echo "gonna rm $line"
      rm "$line"
    else
      if [[ -d "$line" ]]; then
        echo "gonna rm -rf $line"
        rm -rf "$line"
      else
        echo "Unknown thing to sluggerate: $line"
      fi
    fi
  done < $(ls --color=never -1p $line)
done < $file
